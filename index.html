<!doctype html>
<html lang="id" class="h-full">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Circle Monitoring System</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700;800&amp;display=swap" rel="stylesheet">
  <style>
    body { box-sizing: border-box; font-family: 'Plus Jakarta Sans', sans-serif; }
    .tab-active { background: linear-gradient(135deg, #3b82f6, #1d4ed8); color: white; }
    .card-shadow { box-shadow: 0 4px 20px rgba(0,0,0,0.08); }
    .input-focus:focus { box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.3); }
    .btn-gradient { background: linear-gradient(135deg, #3b82f6, #1d4ed8); }
    .btn-gradient:hover { background: linear-gradient(135deg, #2563eb, #1e40af); }
    .fade-in { animation: fadeIn 0.3s ease-out; }
    @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    .photo-thumb { width: 60px; height: 60px; object-fit: cover; border-radius: 8px; cursor: pointer; transition: transform 0.2s; }
    .photo-thumb:hover { transform: scale(1.1); }
    .modal-overlay { background: rgba(0,0,0,0.8); backdrop-filter: blur(4px); }
    ::-webkit-scrollbar { width: 6px; height: 6px; }
    ::-webkit-scrollbar-track { background: #f1f5f9; border-radius: 3px; }
    ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 3px; }
    ::-webkit-scrollbar-thumb:hover { background: #94a3b8; }
  </style>
  <script>
    // DEFINE ALL GLOBAL FUNCTIONS FIRST - Ini yang penting bro!
    let isAdminLoggedIn = false;
    let deleteConfirmId = null;

    function switchTab(tab) {
      if (tab !== 'manage' && isAdminLoggedIn) {
        adminLogout();
      }

      const tabs = ['dashboard', 'input', 'manage'];
      tabs.forEach(t => {
        document.getElementById(`tab-${t}`).classList.remove('tab-active');
        document.getElementById(`tab-${t}`).classList.add('text-slate-600', 'hover:bg-slate-100');
        document.getElementById(`content-${t}`).classList.add('hidden');
      });
      
      document.getElementById(`tab-${tab}`).classList.add('tab-active');
      document.getElementById(`tab-${tab}`).classList.remove('text-slate-600', 'hover:bg-slate-100');
      document.getElementById(`content-${tab}`).classList.remove('hidden');
      
      if (tab === 'dashboard') {
        loadDashboard();
      } else if (tab === 'input') {
        loadPersonnelChecklist();
      }
    }

    function adminLogin() {
      const password = document.getElementById('adminPassword').value;
      if (password === 'admin123') {
        isAdminLoggedIn = true;
        document.getElementById('adminLogin').classList.add('hidden');
        document.getElementById('adminPanel').classList.remove('hidden');
        document.getElementById('loginError').classList.add('hidden');
        loadPersonnelList();
        showToast('Login berhasil!');
      } else {
        document.getElementById('loginError').classList.remove('hidden');
      }
    }

    function adminLogout() {
      isAdminLoggedIn = false;
      document.getElementById('adminLogin').classList.remove('hidden');
      document.getElementById('adminPanel').classList.add('hidden');
      document.getElementById('adminPassword').value = '';
    }

    async function addPersonnel() {
      const name = document.getElementById('newPersonnelName').value.trim();
      const area = document.getElementById('newPersonnelArea').value;
      
      if (!name) {
        showToast('Nama personil harus diisi!', 'error');
        return;
      }

      const { error } = await window.supabase
        .from('personnel')
        .insert([{ name: name.toUpperCase(), area }]);

      if (error) {
        console.error('Error adding personnel:', error);
        showToast('Gagal menambahkan personil!', 'error');
        return;
      }

      document.getElementById('newPersonnelName').value = '';
      showToast('Personil berhasil ditambahkan!');
      loadPersonnelList();
      loadPersonnelChecklist();
    }

    function confirmDelete(id, name) {
      const btn = event.target.closest('button');
      if (deleteConfirmId === id) {
        deletePersonnel(id);
        deleteConfirmId = null;
      } else {
        deleteConfirmId = id;
        btn.innerHTML = '<span class="text-xs uppercase">Yakin?</span>';
        btn.classList.add('bg-red-100');
        setTimeout(() => {
          if (deleteConfirmId === id) {
            btn.innerHTML = '<svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"/></svg>';
            btn.classList.remove('bg-red-100');
            deleteConfirmId = null;
          }
        }, 3000);
      }
    }

    function filterPersonnel() {
      loadPersonnelList();
    }

    function openPhotoModal(src) {
      document.getElementById('modalImage').src = src;
      document.getElementById('photoModal').classList.remove('hidden');
      document.body.style.overflow = 'hidden';
    }

    function closePhotoModal() {
      document.getElementById('photoModal').classList.add('hidden');
      document.body.style.overflow = '';
    }
  </script>
  <style>@view-transition { navigation: auto; }</style>
  <script src="/_sdk/data_sdk.js" type="text/javascript"></script>
  <script src="/_sdk/element_sdk.js" type="text/javascript"></script>
 </head>
 <body class="h-full bg-slate-100">
  <div id="app" class="h-full flex flex-col overflow-hidden"><!-- Header -->
   <header class="bg-gradient-to-r from-blue-600 to-blue-800 text-white px-4 py-4 shadow-lg flex-shrink-0">
    <div class="max-w-6xl mx-auto">
     <h1 id="app-title" class="text-xl md:text-2xl font-bold flex items-center gap-2 uppercase">
      <svg class="w-7 h-7" fill="none" stroke="currentColor" viewbox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z" />
      </svg> Circle Monitoring System</h1>
     <p class="text-blue-100 text-sm mt-1 uppercase">Sistem Pemantauan Kegiatan Circle</p>
    </div>
   </header><!-- Navigation Tabs -->
   <nav class="bg-white shadow-md px-4 py-2 flex-shrink-0">
    <div class="max-w-6xl mx-auto flex gap-2 overflow-x-auto pb-1"><button onclick="switchTab('dashboard')" id="tab-dashboard" class="tab-active px-4 py-2 rounded-lg font-semibold text-sm whitespace-nowrap transition-all flex items-center gap-2 uppercase">
      <svg class="w-4 h-4" fill="none" stroke="currentColor" viewbox="0 0 24 24">
       <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2V6zm10 0a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2V6zM4 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2v-2zm10 0a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2v-2z" />
      </svg> Dashboard </button> <button onclick="switchTab('input')" id="tab-input" class="px-4 py-2 rounded-lg font-semibold text-sm text-slate-600 hover:bg-slate-100 whitespace-nowrap transition-all flex items-center gap-2 uppercase">
      <svg class="w-4 h-4" fill="none" stroke="currentColor" viewbox="0 0 24 24">
       <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" />
      </svg> Input Circle </button> <button onclick="switchTab('manage')" id="tab-manage" class="px-4 py-2 rounded-lg font-semibold text-sm text-slate-600 hover:bg-slate-100 whitespace-nowrap transition-all flex items-center gap-2 uppercase">
      <svg class="w-4 h-4" fill="none" stroke="currentColor" viewbox="0 0 24 24">
       <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z" /><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
      </svg> Kelola Circle </button>
    </div>
   </nav><!-- Main Content -->
   <main class="flex-1 overflow-auto p-4">
    <div class="max-w-6xl mx-auto"><!-- Dashboard Tab -->
     <div id="content-dashboard" class="fade-in"><!-- Stats Cards -->
      <div class="grid grid-cols-2 md:grid-cols-4 gap-3 mb-6">
       <div class="bg-white rounded-xl p-4 card-shadow">
        <div class="flex items-center gap-3">
         <div class="w-10 h-10 bg-blue-100 rounded-lg flex items-center justify-center">
          <svg class="w-5 h-5 text-blue-600" fill="none" stroke="currentColor" viewbox="0 0 24 24">
           <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z" />
          </svg>
         </div>
         <div>
          <p class="text-xs text-slate-500 uppercase">Total Personil</p>
          <p id="stat-personil" class="text-xl font-bold text-slate-800">0</p>
         </div>
        </div>
       </div>
       <div class="bg-white rounded-xl p-4 card-shadow">
        <div class="flex items-center gap-3">
         <div class="w-10 h-10 bg-green-100 rounded-lg flex items-center justify-center">
          <svg class="w-5 h-5 text-green-600" fill="none" stroke="currentColor" viewbox="0 0 24 24">
           <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-6 9l2 2 4-4" />
          </svg>
         </div>
         <div>
          <p class="text-xs text-slate-500 uppercase">Total Sesi</p>
          <p id="stat-sesi" class="text-xl font-bold text-slate-800">0</p>
         </div>
        </div>
       </div>
       <div class="bg-white rounded-xl p-4 card-shadow">
        <div class="flex items-center gap-3">
         <div class="w-10 h-10 bg-amber-100 rounded-lg flex items-center justify-center">
          <svg class="w-5 h-5 text-amber-600" fill="none" stroke="currentColor" viewbox="0 0 24 24">
           <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" />
          </svg>
         </div>
         <div>
          <p class="text-xs text-slate-500 uppercase">Problems</p>
          <p id="stat-problems" class="text-xl font-bold text-slate-800">0</p>
         </div>
        </div>
       </div>
       <div class="bg-white rounded-xl p-4 card-shadow">
        <div class="flex items-center gap-3">
         <div class="w-10 h-10 bg-purple-100 rounded-lg flex items-center justify-center">
          <svg class="w-5 h-5 text-purple-600" fill="none" stroke="currentColor" viewbox="0 0 24 24">
           <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z" />
          </svg>
         </div>
         <div>
          <p class="text-xs text-slate-500 uppercase">Improvements</p>
          <p id="stat-improvements" class="text-xl font-bold text-slate-800">0</p>
         </div>
        </div>
       </div>
      </div><!-- Attendance Chart -->
      <div class="bg-white rounded-xl p-4 card-shadow mb-6">
       <h3 class="font-bold text-slate-800 mb-4 flex items-center gap-2 uppercase">
        <svg class="w-5 h-5 text-blue-600" fill="none" stroke="currentColor" viewbox="0 0 24 24">
         <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z" />
        </svg> üìä Chart Kehadiran Personil</h3>
       <div class="h-64 md:h-80">
        <canvas id="attendanceChart"></canvas>
       </div>
      </div><!-- Sessions List -->
      <div class="bg-white rounded-xl p-4 card-shadow mb-6">
       <h3 class="font-bold text-slate-800 mb-4 flex items-center gap-2 uppercase">
        <svg class="w-5 h-5 text-green-600" fill="none" stroke="currentColor" viewbox="0 0 24 24">
         <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2" />
        </svg> üìã List Sesi Circle</h3>
       <div id="sessions-list" class="space-y-3 max-h-96 overflow-y-auto">
        <p class="text-slate-500 text-center py-8 uppercase">Memuat data...</p>
       </div>
      </div><!-- Problems List -->
      <div class="bg-white rounded-xl p-4 card-shadow mb-6">
       <h3 class="font-bold text-slate-800 mb-4 flex items-center gap-2 uppercase">
        <svg class="w-5 h-5 text-amber-600" fill="none" stroke="currentColor" viewbox="0 0 24 24">
         <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" />
        </svg> ‚ö†Ô∏è List Sharing Problem</h3>
       <div id="problems-list" class="space-y-3 max-h-96 overflow-y-auto">
        <p class="text-slate-500 text-center py-8 uppercase">Memuat data...</p>
       </div>
      </div><!-- Improvements List -->
      <div class="bg-white rounded-xl p-4 card-shadow">
       <h3 class="font-bold text-slate-800 mb-4 flex items-center gap-2 uppercase">
        <svg class="w-5 h-5 text-purple-600" fill="none" stroke="currentColor" viewbox="0 0 24 24">
         <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z" />
        </svg> üí° List Sharing Improvement</h3>
       <div id="improvements-list" class="space-y-3 max-h-96 overflow-y-auto">
        <p class="text-slate-500 text-center py-8 uppercase">Memuat data...</p>
       </div>
      </div>
     </div><!-- Input Tab -->
     <div id="content-input" class="hidden fade-in">
      <div class="bg-white rounded-xl p-4 md:p-6 card-shadow">
       <h3 class="font-bold text-slate-800 mb-6 text-lg flex items-center gap-2 uppercase">
        <svg class="w-6 h-6 text-blue-600" fill="none" stroke="currentColor" viewbox="0 0 24 24">
         <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" />
        </svg> Input Data Circle</h3>
       <form id="circleForm" class="space-y-6"><!-- Date & Shift -->
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
         <div><label class="block text-sm font-semibold text-slate-700 mb-2 uppercase">üìÖ Tanggal</label> <input type="date" id="inputDate" required class="w-full px-4 py-3 border border-slate-300 rounded-lg input-focus focus:outline-none focus:border-blue-500 transition-all">
         </div>
         <div><label class="block text-sm font-semibold text-slate-700 mb-2 uppercase">üïê Shift</label> <select id="inputShift" required class="w-full px-4 py-3 border border-slate-300 rounded-lg input-focus focus:outline-none focus:border-blue-500 transition-all"> <option value="">Pilih Shift</option> <option value="Shift 1">Shift 1</option> <option value="Shift 2">Shift 2</option> <option value="Shift 3">Shift 3</option> <option value="Longshift Pagi">Longshift Pagi</option> <option value="Longshift Malam">Longshift Malam</option> </select>
         </div>
        </div><!-- Personnel Checklist -->
        <div><label class="block text-sm font-semibold text-slate-700 mb-2 uppercase">‚úÖ Personil Hadir</label>
         <div id="personnelChecklist" class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-2 p-4 bg-slate-50 rounded-lg max-h-48 overflow-y-auto">
          <p class="text-slate-500 col-span-full text-center py-4 uppercase">Memuat personil...</p>
         </div>
        </div><!-- Teknik & QA -->
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
         <div class="p-4 bg-slate-50 rounded-lg"><label class="block text-sm font-semibold text-slate-700 mb-2 uppercase">üë∑ Kehadiran Teknik</label>
          <div class="flex items-center gap-4 mb-2"><label class="flex items-center gap-2 cursor-pointer"> <input type="radio" name="teknikHadir" value="ya" class="w-4 h-4 text-blue-600"> <span class="text-sm uppercase">Ya</span> </label> <label class="flex items-center gap-2 cursor-pointer"> <input type="radio" name="teknikHadir" value="tidak" checked class="w-4 h-4 text-blue-600"> <span class="text-sm uppercase">Tidak</span> </label>
          </div><input type="text" id="teknikInisial" placeholder="Inisial Teknik" class="w-full px-3 py-2 border border-slate-300 rounded-lg input-focus focus:outline-none focus:border-blue-500 text-sm uppercase">
         </div>
         <div class="p-4 bg-slate-50 rounded-lg"><label class="block text-sm font-semibold text-slate-700 mb-2 uppercase">üîç Kehadiran QA</label>
          <div class="flex items-center gap-4 mb-2"><label class="flex items-center gap-2 cursor-pointer"> <input type="radio" name="qaHadir" value="ya" class="w-4 h-4 text-blue-600"> <span class="text-sm uppercase">Ya</span> </label> <label class="flex items-center gap-2 cursor-pointer"> <input type="radio" name="qaHadir" value="tidak" checked class="w-4 h-4 text-blue-600"> <span class="text-sm uppercase">Tidak</span> </label>
          </div><input type="text" id="qaInisial" placeholder="Inisial QA" class="w-full px-3 py-2 border border-slate-300 rounded-lg input-focus focus:outline-none focus:border-blue-500 text-sm uppercase">
         </div>
        </div><!-- SPV -->
        <div><label class="block text-sm font-semibold text-slate-700 mb-2 uppercase">üëî Inisial SPV Prod</label> <input type="text" id="spvInisial" required placeholder="Masukkan inisial SPV" class="w-full px-4 py-3 border border-slate-300 rounded-lg input-focus focus:outline-none focus:border-blue-500 transition-all uppercase">
        </div><!-- Circle Photo -->
        <div><label class="block text-sm font-semibold text-slate-700 mb-2 uppercase">üì∏ Foto Circle (WAJIB)</label> <input type="file" id="circlePhoto" accept="image/*" required class="w-full px-4 py-3 border border-slate-300 rounded-lg input-focus focus:outline-none focus:border-blue-500 transition-all file:mr-4 file:py-2 file:px-4 file:rounded-lg file:border-0 file:bg-blue-100 file:text-blue-700 file:font-semibold file:cursor-pointer file:uppercase">
         <div id="circlePhotoPreview" class="mt-2 hidden"><img id="circlePhotoImg" class="max-h-32 rounded-lg">
         </div>
        </div><!-- Problem Sharing -->
        <div class="p-4 bg-amber-50 rounded-lg border border-amber-200"><label class="block text-sm font-semibold text-amber-800 mb-3 uppercase">‚ö†Ô∏è Sharing Problem (Opsional)</label>
         <div class="space-y-3"><input type="text" id="problemText" placeholder="Deskripsi problem..." class="w-full px-3 py-2 border border-amber-300 rounded-lg input-focus focus:outline-none focus:border-amber-500 text-sm uppercase"> <input type="text" id="solutionText" placeholder="Solusi problem..." class="w-full px-3 py-2 border border-amber-300 rounded-lg input-focus focus:outline-none focus:border-amber-500 text-sm uppercase"> <input type="file" id="problemPhoto" accept="image/*" class="w-full px-3 py-2 border border-amber-300 rounded-lg input-focus focus:outline-none focus:border-amber-500 text-sm file:mr-4 file:py-1 file:px-3 file:rounded file:border-0 file:bg-amber-100 file:text-amber-700 file:font-semibold file:cursor-pointer file:uppercase">
         </div>
        </div><!-- Improvement Sharing -->
        <div class="p-4 bg-purple-50 rounded-lg border border-purple-200"><label class="block text-sm font-semibold text-purple-800 mb-3 uppercase">üí° Sharing Improvement (Opsional)</label>
         <div class="space-y-3"><input type="text" id="improvementBefore" placeholder="Kondisi Before..." class="w-full px-3 py-2 border border-purple-300 rounded-lg input-focus focus:outline-none focus:border-purple-500 text-sm uppercase"> <input type="text" id="improvementPic" placeholder="PIC Improvement..." class="w-full px-3 py-2 border border-purple-300 rounded-lg input-focus focus:outline-none focus:border-purple-500 text-sm uppercase"> <input type="text" id="improvementDetail" placeholder="Detail improvement..." class="w-full px-3 py-2 border border-purple-300 rounded-lg input-focus focus:outline-none focus:border-purple-500 text-sm uppercase"> <input type="file" id="improvementPhoto" accept="image/*" class="w-full px-3 py-2 border border-purple-300 rounded-lg input-focus focus:outline-none focus:border-purple-500 text-sm file:mr-4 file:py-1 file:px-3 file:rounded file:border-0 file:bg-purple-100 file:text-purple-700 file:font-semibold file:cursor-pointer file:uppercase">
         </div>
        </div><!-- Submit Button --> <button type="submit" id="submitBtn" class="w-full btn-gradient text-white py-4 rounded-xl font-bold text-lg shadow-lg hover:shadow-xl transition-all flex items-center justify-center gap-2 uppercase">
         <svg class="w-5 h-5" fill="none" stroke="currentColor" viewbox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
         </svg> Simpan Data Circle </button>
       </form>
      </div>
     </div><!-- Manage Tab -->
     <div id="content-manage" class="hidden fade-in"><!-- Admin Login -->
      <div id="adminLogin" class="bg-white rounded-xl p-6 card-shadow mb-6">
       <h3 class="font-bold text-slate-800 mb-4 text-lg flex items-center gap-2 uppercase">
        <svg class="w-6 h-6 text-blue-600" fill="none" stroke="currentColor" viewbox="0 0 24 24">
         <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z" />
        </svg> üîê Admin Login</h3>
       <div class="flex gap-3"><input type="password" id="adminPassword" placeholder="Masukkan password admin" class="flex-1 px-4 py-3 border border-slate-300 rounded-lg input-focus focus:outline-none focus:border-blue-500 transition-all"> <button onclick="adminLogin()" class="btn-gradient text-white px-6 py-3 rounded-lg font-semibold hover:shadow-lg transition-all uppercase">Login</button>
       </div>
       <p id="loginError" class="text-red-500 text-sm mt-2 hidden uppercase">Password salah!</p>
      </div><!-- Admin Panel (Hidden by default) -->
      <div id="adminPanel" class="hidden"><!-- Add Personnel -->
       <div class="bg-white rounded-xl p-6 card-shadow mb-6">
        <h3 class="font-bold text-slate-800 mb-4 text-lg flex items-center gap-2 uppercase">
         <svg class="w-6 h-6 text-green-600" fill="none" stroke="currentColor" viewbox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M18 9v3m0 0v3m0-3h3m-3 0h-3m-2-5a4 4 0 11-8 0 4 4 0 018 0zM3 20a6 6 0 0112 0v1H3v-1z" />
         </svg> ‚ûï Tambah Personil</h3>
        <div class="flex flex-col md:flex-row gap-3"><input type="text" id="newPersonnelName" placeholder="Nama personil" class="flex-1 px-4 py-3 border border-slate-300 rounded-lg input-focus focus:outline-none focus:border-blue-500 transition-all uppercase"> <select id="newPersonnelArea" class="px-4 py-3 border border-slate-300 rounded-lg input-focus focus:outline-none focus:border-blue-500 transition-all uppercase"> <option value="Injeksi">Injeksi</option> <option value="Non Injeksi">Non Injeksi</option> </select> <button onclick="addPersonnel()" class="bg-green-600 hover:bg-green-700 text-white px-6 py-3 rounded-lg font-semibold transition-all flex items-center gap-2 uppercase">
          <svg class="w-5 h-5" fill="none" stroke="currentColor" viewbox="0 0 24 24">
           <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" />
          </svg> Tambah </button>
        </div>
       </div><!-- Personnel List -->
       <div class="bg-white rounded-xl p-6 card-shadow">
        <div class="flex flex-col md:flex-row md:items-center justify-between mb-4 gap-3">
         <h3 class="font-bold text-slate-800 text-lg flex items-center gap-2 uppercase">
          <svg class="w-6 h-6 text-blue-600" fill="none" stroke="currentColor" viewbox="0 0 24 24">
           <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z" />
          </svg> üìã Daftar Personil</h3><select id="filterArea" onchange="filterPersonnel()" class="px-4 py-2 border border-slate-300 rounded-lg input-focus focus:outline-none focus:border-blue-500 transition-all uppercase"> <option value="Semua">üîç Semua Area</option> <option value="Injeksi">Injeksi</option> <option value="Non Injeksi">Non Injeksi</option> </select>
        </div>
        <div id="personnelList" class="space-y-2 max-h-96 overflow-y-auto">
         <p class="text-slate-500 text-center py-8 uppercase">Memuat personil...</p>
        </div>
       </div><!-- Logout Button --> <button onclick="adminLogout()" class="mt-4 w-full bg-slate-600 hover:bg-slate-700 text-white py-3 rounded-xl font-semibold transition-all flex items-center justify-center gap-2 uppercase">
        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewbox="0 0 24 24">
         <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1" />
        </svg> Logout Admin </button>
      </div>
     </div>
    </div>
   </main>
  </div><!-- Photo Modal -->
  <div id="photoModal" class="fixed inset-0 modal-overlay z-50 hidden flex items-center justify-center p-4" onclick="closePhotoModal()">
   <div class="relative max-w-4xl max-h-full"><button onclick="closePhotoModal()" class="absolute -top-10 right-0 text-white hover:text-gray-300 transition-colors">
     <svg class="w-8 h-8" fill="none" stroke="currentColor" viewbox="0 0 24 24">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
     </svg></button> <img id="modalImage" class="max-w-full max-h-[80vh] rounded-xl shadow-2xl" onclick="event.stopPropagation()">
   </div>
  </div><!-- Toast -->
  <div id="toast" class="fixed bottom-4 right-4 bg-green-600 text-white px-6 py-3 rounded-xl shadow-lg transform translate-y-20 opacity-0 transition-all duration-300 z-50 flex items-center gap-2">
   <svg class="w-5 h-5" fill="none" stroke="currentColor" viewbox="0 0 24 24">
    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
   </svg><span id="toastMessage" class="uppercase">Success!</span>
  </div>
  <script>
    // Initialize Supabase
    const SUPABASE_URL = 'https://qohalhhmrzerztmxfymb.supabase.co';
    const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InFvaGFsaGhtcnplcnp0bXhmeW1iIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjgyODQyNTYsImV4cCI6MjA4Mzg2MDI1Nn0.9Ih6qFl1wXnsgc7i7js6NNuKyBA6pH1yM4TFQsfEp0o';
    const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

    let attendanceChart = null;

    // Supabase Functions
    async function getPersonnel() {
      const { data, error } = await supabase
        .from('personnel')
        .select('*')
        .order('name', { ascending: true });
      
      if (error) {
        console.error('Error fetching personnel:', error);
        return [];
      }
      return data || [];
    }

    async function deletePersonnel(id) {
      const { error } = await supabase
        .from('personnel')
        .delete()
        .eq('id', id);

      if (error) {
        console.error('Error deleting personnel:', error);
        showToast('Gagal menghapus personil!', 'error');
        return;
      }

      showToast('Personil berhasil dihapus!');
      loadPersonnelList();
      loadPersonnelChecklist();
    }

    async function loadPersonnelList() {
      const personnel = await getPersonnel();
      const filter = document.getElementById('filterArea').value;
      const filtered = filter === 'Semua' ? personnel : personnel.filter(p => p.area === filter);
      
      const container = document.getElementById('personnelList');
      
      if (filtered.length === 0) {
        container.innerHTML = '<p class="text-slate-500 text-center py-8 uppercase">Belum ada personil</p>';
        return;
      }

      container.innerHTML = filtered.map(p => `
        <div class="flex items-center justify-between p-3 bg-slate-50 rounded-lg hover:bg-slate-100 transition-colors">
          <div class="flex items-center gap-3">
            <div class="w-10 h-10 bg-blue-100 rounded-full flex items-center justify-center">
              <span class="text-blue-600 font-bold">${p.name.charAt(0).toUpperCase()}</span>
            </div>
            <div>
              <p class="font-semibold text-slate-800 uppercase">${p.name}</p>
              <p class="text-xs text-slate-500 uppercase">${p.area}</p>
            </div>
          </div>
          <button onclick="confirmDelete('${p.id}', '${p.name}')" class="text-red-500 hover:text-red-700 hover:bg-red-100 p-2 rounded-lg transition-colors">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"/></svg>
          </button>
        </div>
      `).join('');
    }

    async function loadPersonnelChecklist() {
      const personnel = await getPersonnel();
      const container = document.getElementById('personnelChecklist');
      
      if (personnel.length === 0) {
        container.innerHTML = '<p class="text-slate-500 col-span-full text-center py-4 uppercase">Belum ada personil. Tambah di menu Kelola Circle.</p>';
        return;
      }

      container.innerHTML = personnel.map(p => `
        <label class="flex items-center gap-2 p-2 bg-white rounded-lg cursor-pointer hover:bg-blue-50 transition-colors border border-slate-200">
          <input type="checkbox" value="${p.id}" data-name="${p.name}" class="personnel-checkbox w-4 h-4 text-blue-600 rounded">
          <span class="text-sm text-slate-700 uppercase">${p.name}</span>
        </label>
      `).join('');
    }

    // Session Functions
    async function getSessions() {
      const { data, error } = await supabase
        .from('sessions')
        .select('*')
        .order('date', { ascending: false });
      
      if (error) {
        console.error('Error fetching sessions:', error);
        return [];
      }
      return data || [];
    }

    async function getProblems() {
      const { data, error } = await supabase
        .from('problems')
        .select('*')
        .order('created_at', { ascending: false });
      
      if (error) {
        console.error('Error fetching problems:', error);
        return [];
      }
      return data || [];
    }

    async function getImprovements() {
      const { data, error } = await supabase
        .from('improvements')
        .select('*')
        .order('created_at', { ascending: false });
      
      if (error) {
        console.error('Error fetching improvements:', error);
        return [];
      }
      return data || [];
    }

    // Convert file to base64
    function fileToBase64(file) {
      return new Promise((resolve, reject) => {
        const reader = new FileReader();
        reader.readAsDataURL(file);
        reader.onload = () => resolve(reader.result);
        reader.onerror = error => reject(error);
      });
    }

    // Form submission
    document.getElementById('circleForm').addEventListener('submit', async function(e) {
      e.preventDefault();
      
      const submitBtn = document.getElementById('submitBtn');
      submitBtn.disabled = true;
      submitBtn.innerHTML = '<svg class="w-5 h-5 animate-spin" fill="none" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path></svg> <span class="uppercase">Menyimpan...</span>';

      try {
        const date = document.getElementById('inputDate').value;
        const shift = document.getElementById('inputShift').value;
        const teknikHadir = document.querySelector('input[name="teknikHadir"]:checked').value;
        const teknikInisial = document.getElementById('teknikInisial').value.toUpperCase();
        const qaHadir = document.querySelector('input[name="qaHadir"]:checked').value;
        const qaInisial = document.getElementById('qaInisial').value.toUpperCase();
        const spvInisial = document.getElementById('spvInisial').value.toUpperCase();
        
        // Get checked personnel
        const checkedPersonnel = [];
        document.querySelectorAll('.personnel-checkbox:checked').forEach(cb => {
          checkedPersonnel.push({ id: cb.value, name: cb.dataset.name });
        });

        // Get circle photo
        const circlePhotoFile = document.getElementById('circlePhoto').files[0];
        const circlePhoto = circlePhotoFile ? await fileToBase64(circlePhotoFile) : null;

        // Create session
        const { data: sessionData, error: sessionError } = await supabase
          .from('sessions')
          .insert([{
            date,
            shift,
            personnel: checkedPersonnel,
            teknik_hadir: teknikHadir === 'ya',
            teknik_inisial: teknikInisial,
            qa_hadir: qaHadir === 'ya',
            qa_inisial: qaInisial,
            spv_inisial: spvInisial,
            photo: circlePhoto
          }])
          .select();

        if (sessionError) {
          throw sessionError;
        }

        const sessionId = sessionData[0].id;

        // Handle problem sharing
        const problemText = document.getElementById('problemText').value.trim().toUpperCase();
        const solutionText = document.getElementById('solutionText').value.trim().toUpperCase();
        const problemPhotoFile = document.getElementById('problemPhoto').files[0];
        
        if (problemText) {
          const problemPhoto = problemPhotoFile ? await fileToBase64(problemPhotoFile) : null;
          
          const { error: problemError } = await supabase
            .from('problems')
            .insert([{
              session_id: sessionId,
              problem: problemText,
              solution: solutionText,
              photo: problemPhoto,
              date,
              shift
            }]);

          if (problemError) {
            console.error('Error saving problem:', problemError);
          }
        }

        // Handle improvement sharing
        const improvementBefore = document.getElementById('improvementBefore').value.trim().toUpperCase();
        const improvementPic = document.getElementById('improvementPic').value.trim().toUpperCase();
        const improvementDetail = document.getElementById('improvementDetail').value.trim().toUpperCase();
        const improvementPhotoFile = document.getElementById('improvementPhoto').files[0];
        
        if (improvementDetail) {
          const improvementPhoto = improvementPhotoFile ? await fileToBase64(improvementPhotoFile) : null;
          
          const { error: improvementError } = await supabase
            .from('improvements')
            .insert([{
              session_id: sessionId,
              before: improvementBefore,
              pic: improvementPic,
              detail: improvementDetail,
              photo: improvementPhoto,
              date,
              shift
            }]);

          if (improvementError) {
            console.error('Error saving improvement:', improvementError);
          }
        }
        
        // Reset form
        document.getElementById('circleForm').reset();
        document.getElementById('circlePhotoPreview').classList.add('hidden');
        
        showToast('Data circle berhasil disimpan!');
        switchTab('dashboard');
        
      } catch (error) {
        console.error('Error saving data:', error);
        showToast('Gagal menyimpan data!', 'error');
      } finally {
        submitBtn.disabled = false;
        submitBtn.innerHTML = '<svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/></svg> <span class="uppercase">Simpan Data Circle</span>';
      }
    });

    // Photo preview
    document.getElementById('circlePhoto').addEventListener('change', async function(e) {
      if (this.files[0]) {
        const base64 = await fileToBase64(this.files[0]);
        document.getElementById('circlePhotoImg').src = base64;
        document.getElementById('circlePhotoPreview').classList.remove('hidden');
      }
    });

    // Dashboard Functions
    async function loadDashboard() {
      const personnel = await getPersonnel();
      const sessions = await getSessions();
      const problems = await getProblems();
      const improvements = await getImprovements();

      // Update stats
      document.getElementById('stat-personil').textContent = personnel.length;
      document.getElementById('stat-sesi').textContent = sessions.length;
      document.getElementById('stat-problems').textContent = problems.length;
      document.getElementById('stat-improvements').textContent = improvements.length;

      // Update attendance chart
      updateAttendanceChart(personnel, sessions);

      // Update sessions list
      updateSessionsList(sessions);

      // Update problems list
      updateProblemsList(problems);

      // Update improvements list
      updateImprovementsList(improvements);
    }

    function updateAttendanceChart(personnel, sessions) {
      const ctx = document.getElementById('attendanceChart').getContext('2d');
      
      // Count attendance per personnel
      const attendanceCount = {};
      personnel.forEach(p => { attendanceCount[p.name] = 0; });
      
      sessions.forEach(s => {
        const attendees = s.personnel || [];
        attendees.forEach(a => {
          if (attendanceCount[a.name] !== undefined) {
            attendanceCount[a.name]++;
          }
        });
      });

      const labels = Object.keys(attendanceCount);
      const data = Object.values(attendanceCount);

      if (attendanceChart) {
        attendanceChart.destroy();
      }

      attendanceChart = new Chart(ctx, {
        type: 'bar',
        data: {
          labels,
          datasets: [{
            label: 'JUMLAH KEHADIRAN',
            data,
            backgroundColor: 'rgba(59, 130, 246, 0.8)',
            borderColor: 'rgba(59, 130, 246, 1)',
            borderWidth: 1,
            borderRadius: 6
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            legend: { display: false }
          },
          scales: {
            y: {
              beginAtZero: true,
              ticks: { stepSize: 1 }
            },
            x: {
              ticks: {
                maxRotation: 45,
                minRotation: 45
              }
            }
          }
        }
      });
    }

    function updateSessionsList(sessions) {
      const container = document.getElementById('sessions-list');
      
      if (sessions.length === 0) {
        container.innerHTML = '<p class="text-slate-500 text-center py-8 uppercase">Belum ada sesi circle</p>';
        return;
      }

      container.innerHTML = sessions.map(s => {
        const attendees = s.personnel || [];
        const attendeeNames = attendees.map(a => a.name).join(', ') || '-';
        const formattedDate = new Date(s.date).toLocaleDateString('id-ID', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' });
        
        return `
          <div class="p-4 bg-slate-50 rounded-lg border border-slate-200">
            <div class="flex flex-col md:flex-row md:items-start justify-between gap-3">
              <div class="flex-1">
                <div class="flex items-center gap-2 mb-2">
                  <span class="bg-blue-100 text-blue-700 px-2 py-1 rounded text-xs font-semibold uppercase">${s.shift}</span>
                  <span class="text-slate-600 text-sm">${formattedDate}</span>
                </div>
                <p class="text-sm mb-1 uppercase"><span class="font-semibold">Personil:</span> ${attendeeNames}</p>
                <p class="text-sm mb-1 uppercase"><span class="font-semibold">Teknik:</span> ${s.teknik_hadir ? '‚úÖ ' + s.teknik_inisial : '‚ùå'}</p>
                <p class="text-sm mb-1 uppercase"><span class="font-semibold">QA:</span> ${s.qa_hadir ? '‚úÖ ' + s.qa_inisial : '‚ùå'}</p>
                <p class="text-sm uppercase"><span class="font-semibold">SPV:</span> ${s.spv_inisial}</p>
              </div>
              ${s.photo ? `<img src="${s.photo}" class="photo-thumb" onclick="openPhotoModal('${s.photo.replace(/'/g, "\\'")}')" alt="Foto Circle">` : ''}
            </div>
          </div>
        `;
      }).join('');
    }

    function updateProblemsList(problems) {
      const container = document.getElementById('problems-list');
      
      if (problems.length === 0) {
        container.innerHTML = '<p class="text-slate-500 text-center py-8 uppercase">Belum ada problem sharing</p>';
        return;
      }

      container.innerHTML = problems.map(p => {
        const formattedDate = new Date(p.date).toLocaleDateString('id-ID', { day: 'numeric', month: 'short', year: 'numeric' });
        return `
          <div class="p-4 bg-amber-50 rounded-lg border border-amber-200">
            <div class="flex flex-col md:flex-row md:items-start justify-between gap-3">
              <div class="flex-1">
                <div class="flex items-center gap-2 mb-2">
                  <span class="bg-amber-100 text-amber-700 px-2 py-1 rounded text-xs font-semibold uppercase">${p.shift}</span>
                  <span class="text-slate-600 text-sm">${formattedDate}</span>
                </div>
                <p class="text-sm mb-1 uppercase"><span class="font-semibold text-amber-800">‚ö†Ô∏è Problem:</span> ${p.problem}</p>
                ${p.solution ? `<p class="text-sm uppercase"><span class="font-semibold text-green-700">‚úÖ Solusi:</span> ${p.solution}</p>` : ''}
              </div>
              ${p.photo ? `<img src="${p.photo}" class="photo-thumb" onclick="openPhotoModal('${p.photo.replace(/'/g, "\\'")}')" alt="Foto Problem">` : ''}
            </div>
          </div>
        `;
      }).join('');
    }

    function updateImprovementsList(improvements) {
      const container = document.getElementById('improvements-list');
      
      if (improvements.length === 0) {
        container.innerHTML = '<p class="text-slate-500 text-center py-8 uppercase">Belum ada improvement sharing</p>';
        return;
      }

      container.innerHTML = improvements.map(i => {
        const formattedDate = new Date(i.date).toLocaleDateString('id-ID', { day: 'numeric', month: 'short', year: 'numeric' });
        return `
          <div class="p-4 bg-purple-50 rounded-lg border border-purple-200">
            <div class="flex flex-col md:flex-row md:items-start justify-between gap-3">
              <div class="flex-1">
                <div class="flex items-center gap-2 mb-2">
                  <span class="bg-purple-100 text-purple-700 px-2 py-1 rounded text-xs font-semibold uppercase">${i.shift}</span>
                  <span class="text-slate-600 text-sm">${formattedDate}</span>
                </div>
                ${i.before ? `<p class="text-sm mb-1 uppercase"><span class="font-semibold text-purple-800">üìã Before:</span> ${i.before}</p>` : ''}
                ${i.pic ? `<p class="text-sm mb-1 uppercase"><span class="font-semibold text-purple-800">üë§ PIC:</span> ${i.pic}</p>` : ''}
                <p class="text-sm uppercase"><span class="font-semibold text-purple-800">üí° Detail:</span> ${i.detail}</p>
              </div>
              ${i.photo ? `<img src="${i.photo}" class="photo-thumb" onclick="openPhotoModal('${i.photo.replace(/'/g, "\\'")}')" alt="Foto Improvement">` : ''}
            </div>
          </div>
        `;
      }).join('');
    }

    // Toast
    function showToast(message, type = 'success') {
      const toast = document.getElementById('toast');
      const toastMessage = document.getElementById('toastMessage');
      
      toast.className = `fixed bottom-4 right-4 px-6 py-3 rounded-xl shadow-lg transform transition-all duration-300 z-50 flex items-center gap-2 ${type === 'error' ? 'bg-red-600' : 'bg-green-600'} text-white`;
      toastMessage.textContent = message.toUpperCase();
      
      toast.classList.remove('translate-y-20', 'opacity-0');
      
      setTimeout(() => {
        toast.classList.add('translate-y-20', 'opacity-0');
      }, 3000);
    }

    // Initialize
    function init() {
      // Set today's date as default
      document.getElementById('inputDate').valueAsDate = new Date();
      
      // Load initial views
      loadDashboard();
      loadPersonnelChecklist();
    }

    // Keyboard shortcuts
    document.addEventListener('keydown', (e) => {
      if (e.key === 'Escape') {
        closePhotoModal();
      }
    });

    // Start app
    init();
  </script>
 <script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9bd2f17cf73c4ad7',t:'MTc2ODI4Njg1OC4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
